<% disable_sort = defined? sort_title %>

<% sort_title ||= @sort.split('_').map(&:titleize).join('-') %>

<div class="col-sm-8 cs-main-area">

  <div class="panel panel-default">

    <div class="panel-heading">

      <h4 class="cs-no-margin">
        <%= sort_title %>
        <span class='cs-packages-word'> Packages </span>
        <span class='cs-packages-short-word'> Pkgs </span>
      </h4>

      <div class="btn-group cs-pull-right">

        <%
          query_params = {}
          query_params[:search] = params[:search] \
            if params[:search].present?

          query_params.merge! \
            params.select { |k, v| k.ends_with? "_id" }

          query_params.deep_symbolize_keys!
        %>

        <% cookies.permanent[:sort] ||= 'top' %>

        <% unless disable_sort %>

          <%= link_to 'Top', settings_path(sort: 'top'),
            class: "btn btn-sm #{ ( cookies[:sort] == 'top' ) ? ' btn-raised btn-primary hidden-xs' : '' }" %>
          <%= link_to 'New', settings_path(sort: 'new'),
            class: "btn btn-sm #{ ( cookies[:sort] == 'new' ) ? ' btn-raised btn-primary hidden-xs' : '' }" %>

          <% if %w[ a_z z_a ].include? cookies[:sort] %>
            <%= link_to sort_title, settings_path(sort: cookies[:sort].reverse),
              class: "btn btn-sm btn-raised btn-primary hidden-xs" %>
          <% else %>
            <%= link_to 'A-Z', settings_path(sort: 'a_z'), class: "btn btn-sm" %>
          <% end %>

          <%= link_to 'Hot', settings_path(sort: 'hot'),
            class: "btn btn-sm #{ ( cookies[:sort] == 'hot' ) ? ' btn-raised btn-primary hidden-xs' : '' }" %>

        <% end %>

      </div>

    </div>

    <div class="panel-body">

      <div class="list-group cs-no-margin row">

        <%= render partial: 'layouts/package_list', locals: { packages: @packages } %>

      </div>

    </div>

      <% if @disable_paginate %>

        <div class="panel-footer cs-center cs-no-padding">

          <%= link_to root_path, class: "btn btn-default cs-side-bar-footer-link cs-full-width cs-no-margin" do %>
            View all Packages
          <% end %>

        </div>

      <% else %>

        <div class="panel-footer">

          <%= render partial: 'layouts/package_pagination', locals: { packages: @packages } %>

        </div>

      <% end %>

  </div>

  <div class="visible-xs">
    <%= render 'layouts/made_with_love_panel' %>
  </div>

</div>
