<div class="col-sm-8 cs-main-area">

  <div class="panel panel-default">

    <div class="panel-heading">

      <h4 class="cs-no-margin">
        <%= @sort.titleize %>
        Packages
      </h4>

      <div class="btn-group cs-pull-right">

        <%= link_to 'Top', root_path(search: params[:search]), class: "btn #{ ( params[:sort].present? ) ? '' : ' btn-raised btn-primary' }" %>
        <%= link_to 'New', root_path(search: params[:search], sort: 'new'), class: "btn #{ ( params[:sort] == 'new' ) ? ' btn-raised btn-primary' : '' }" %>
        <%= link_to 'Pop', root_path(search: params[:search], sort: 'pop'), class: "btn #{ ( params[:sort] == 'pop' ) ? ' btn-raised btn-primary' : '' }" %>

      </div>

    </div>

    <div class="panel-body">

      <div class="list-group cs-no-margin row">

        <%= render partial: 'package_list', locals: { packages: @packages } %>

      </div>

    </div>

    <div class="panel-footer">
      <% if @packages.count > WillPaginate.per_page %>
        <%= will_paginate @packages, class: 'pagination cs-full-width cs-no-margin cs-center' %>
      <% else %>
        <div class='pagination cs-full-width cs-no-margin cs-center'>
          <%= link_to 'View all Packages', root_path(sort: params[:sort]) %>
        </div>
      <% end %>
    </div>

  </div>

</div>

<%= render 'layouts/category_sidebar' %>

<script>
  $(document).ready(function() {
    if ( $('.pagination').length ) {
      $(window).scroll(function() {
        var url = $('.pagination .next_page').attr('href');
        if (url && $(window).scrollTop() > $(document).height() - $(window).height() - 50) {
          $('.pagination').text("Please Wait...");
          return $.getScript(url);
        }
      });
      return $(window).scroll();
    }
  });
</script>
